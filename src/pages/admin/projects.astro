---
import AdminLayout from '../../layouts/AdminLayout.astro';
import AuthGuard from '../../components/admin/AuthGuard.tsx';
import AdminShell from '../../components/admin/AdminShell.tsx';
import ContentTable from '../../components/admin/ContentTable.tsx';
import { getCollection } from 'astro:content';

const projects = await getCollection('projects');

const rows = projects
  .sort((a, b) => b.data.year - a.data.year)
  .map((p) => ({
    _slug: p.data.projectSlug,
    title: p.data.title_cs,
    title_en: p.data.title_en,
    status: p.data.status,
    category: p.data.category,
    year: p.data.year,
    featured: p.data.featured,
    stack: p.data.stack?.join(', ') || '',
  }));

const columns = [
  { key: 'title', label: 'Name' },
  { key: 'status', label: 'Status' },
  { key: 'category', label: 'Category' },
  { key: 'year', label: 'Year' },
  { key: 'featured', label: 'Featured' },
  { key: 'stack', label: 'Stack' },
];

const currentPath = Astro.url.pathname;
---

<AdminLayout title="Projects">
  <AuthGuard client:load slot="app">
    <AdminShell currentPath={currentPath} client:load>
      <ContentTable
        title="Projects"
        columns={columns}
        rows={rows}
        contentFolder="src/content/projects"
        newLabel="New Project"
        client:load
      />
    </AdminShell>
  </AuthGuard>
</AdminLayout>
